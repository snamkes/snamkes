<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>무기 확률 뽑기</title>
</head>
<body>
    <h1>무기 확률 뽑기</h1>
    <form method="POST" action="/" id="drawForm">
        <label for="num_draws">뽑을 횟수:</label>
        <input type="number" id="num_draws" name="num_draws" min="1" required>
        <input type="submit" value="무기 뽑기">
    </form>
    <div id="resultsContainer">
        {% if drawn_weapons %}
        <h2>뽑은 무기:</h2>
        <ul>
            {% for idx, weapon in enumerate(drawn_weapons, start=1) %}
            <li>{{ "뽑기 {}번째: {}".format(idx, weapon) }}</li>
            {% endfor %}
        </ul>
        {% endif %}
    </div>
    <form method="POST" action="/reset">
        <input type="submit" value="초기화">
    </form>
    
    <!-- 여기에 JavaScript 코드 추가 -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('drawForm').addEventListener('submit', function(event) {
            event.preventDefault(); // 폼 제출 기본 동작 막기
            var numDraws = document.getElementById('num_draws').value;

            // 서버로 요청 보내기
            fetch('/', {
                method: 'POST',
                body: new URLSearchParams({ num_draws: numDraws }),
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                }
            })
            .then(response => response.text())
            .then(data => {
                // 서버로부터 받은 데이터를 화면에 표시
                var resultsContainer = document.getElementById('resultsContainer');
                resultsContainer.innerHTML = ''; // 이전 결과 초기화

                // 무기 문자열을 개행 문자를 기준으로 나누어 출력
                var weapons = data.split('\n');
                weapons.forEach(function(weapon, index) {
                    var weaponElement = document.createElement('p');
                    weaponElement.textContent = '뽑기 ' + (index + 1) + '번째: ' + weapon;
                    resultsContainer.appendChild(weaponElement);
                });
            })
            .catch(error => {
                console.error('무기 뽑기 오류:', error);
            });
        });
    });
    </script>
</body>
</html>